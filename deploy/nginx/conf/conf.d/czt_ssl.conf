server {
    server_name auth.*;
    listen 443 ssl;
    ssl_certificate "/etc/nginx/certs/czt-test.cer";
    ssl_certificate_key "/etc/nginx/keys/czt-test.key";
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLEsl_session_cache shared:SSL:1m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location  /img/ {
        proxy_pass         http://auth-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;

        expires max;
        add_header Cache-Control "public, no-transform";
        access_log off;
    }


    location  /styles/ {
        proxy_pass         http://auth-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;

        expires max;
        add_header Cache-Control "public, no-transform";
        access_log off;
    }

    
    location  /fonts/ {
        proxy_pass         http://auth-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;

        expires max; 
        add_header Cache-Control "public, no-transform";
        access_log off;
    }

    location / {
        proxy_pass         http://auth-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;
    }

}

server {
    server_name fs.*;
    listen 443 ssl;
    ssl_certificate "/etc/nginx/certs/czt-test.cer";
    ssl_certificate_key "/etc/nginx/keys/czt-test.key";
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLEsl_session_cache shared:SSL:1m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass         http://fs-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;
    }
}

server {
    server_name pn.*;
    listen 443 ssl;
    ssl_certificate "/etc/nginx/certs/czt-test.cer";
    ssl_certificate_key "/etc/nginx/keys/czt-test.key";
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLEsl_session_cache shared:SSL:1m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass         http://pn-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;
    }
}

server {
    server_name bff.*;
    listen 443 ssl;
    ssl_certificate "/etc/nginx/certs/czt-test.cer";
    ssl_certificate_key "/etc/nginx/keys/czt-test.key";
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLEsl_session_cache shared:SSL:1m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass       http://bff-app$request_uri;
        proxy_set_header Host $host;
        proxy_set_header X-Real_IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Forwarded "$proxy_add_x_forwarded_for;proto=$scheme";
        proxy_redirect http:// https://;

        proxy_buffers             4 512k;
        proxy_buffer_size         256k;
        proxy_busy_buffers_size   512k;

        proxy_connect_timeout     300s;
        proxy_read_timeout        300s;
        proxy_send_timeout        300s;
    }


    location /oauth2 {
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection ""; #$connection_upgrade;
        proxy_pass         http://bff-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;
#        add_header Access-Control-Allow-Headers "*" always;
#        add_header Access-Control-Allow-Methods "*" always;
#        add_header Access-Control-Allow-Origin  "*" always;
      
        proxy_buffers             4 512k;
        proxy_buffer_size         256k;
        proxy_busy_buffers_size   512k;

        proxy_connect_timeout     300s;
        proxy_read_timeout        300s;
        proxy_send_timeout        300s;
    }
  
    location /fs {
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection ""; #$connection_upgrade;
        proxy_pass         http://bff-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;
#        add_header Access-Control-Allow-Headers "*" always;
#        add_header Access-Control-Allow-Methods "*" always;
#        add_header Access-Control-Allow-Origin  "*" always;
      
        proxy_buffers             4 512k;
        proxy_buffer_size         256k;
        proxy_busy_buffers_size   512k;

        proxy_connect_timeout     300s;
        proxy_read_timeout        300s;
        proxy_send_timeout        300s;
    }

    location /pn {
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection ""; #$connection_upgrade;
        proxy_pass         http://bff-app$request_uri;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Host $server_name;
        proxy_redirect http:// https://;
#        add_header Access-Control-Allow-Headers "*" always;
#        add_header Access-Control-Allow-Methods "*" always;
#        add_header Access-Control-Allow-Origin  "*" always;
      
        proxy_buffers             4 512k;
        proxy_buffer_size         256k;
        proxy_busy_buffers_size   512k;

        proxy_connect_timeout     300s;
        proxy_read_timeout        300s;
        proxy_send_timeout        300s;
    }    
}
